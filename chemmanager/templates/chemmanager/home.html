{% extends "chemmanager/chemmanager_base.html" %}
{% load crispy_forms_tags %}

<script>
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })
</script>

{% block content %}
    <form class="card card-sm mb-4">
        <div class="card-body row no-gutters align-items-center">
            <!--end of col-->
            <div class="col">
                <input class="form-control form-control-lg form-control-borderless" type="text"
                       placeholder="Search topics or keywords" name="q" value="{{ request.Get.q }}">
            </div>
            <!--end of col-->
            <div class="col-auto">&nbsp;</div>
            <div class="col-auto">
                <button class="btn btn-lg btn-success" type="submit" value="Search Chemicals">Search</button>
            </div>
            <!--end of col-->
        </div>
    </form>

    {% for chemical in chemicals %}
        <article class="media content-section">
            <div class="media-body">
                <div class="d-flex w-100 bd-highlight">
                    <a class="btn btn-lg btn-outline-secondary mb-2 mr-auto" data-toggle="collapse"
                       data-target="#collapseAll-{{ chemical.id }}"
                       aria-controls="collapseAll-{{ chemical.id }}">
                        {{ chemical.name }}
                    </a>
                    <div class="m-2">{{ chemical.structure }}</div>
                    <div class="m-2">{{ chemical.stock_set.first.quantity }} {{ chemical.stock_set.first.unit }}</div>
                </div>
                <div class="collapse" id="collapseAll-{{ chemical.id }}">
                    <form class="mb-1" action="{% url 'stock-create' chemical.id %}">
                        <button class="btn btn-info btn-sm" type="button" data-toggle="collapse"
                                data-target="#collapseStock-{{ chemical.id }}" aria-expanded="true"
                                aria-controls="collapseStock-{{ chemical.id }}">Stock
                        </button>
                        <button class="btn btn-info btn-sm" type="button" data-toggle="collapse"
                                data-target="#collapseProperties-{{ chemical.id }}" aria-expanded="false"
                                aria-controls="collapseProperties-{{ chemical.id }}">Properties
                        </button>
                        <button class="btn btn-warning btn-sm" name="chemical" type="submit"
                                value="{{ chemical.id }}">Add Stock
                        </button>
                        <a class="btn btn-warning btn-sm" href="{% url 'chemical-update' chemical.id %}">Edit</a>
                    </form>
                    <div class="collapse" id="collapseProperties-{{ chemical.id }}">
                        <dl class="row">
                            {% if chemical.molar_mass %}
                                <dt class="col-sm-3">Molare Mass</dt>
                                <dd class="col-sm-9"> {{ chemical.molar_mass }} g/mol</dd>
                            {% endif %}
                            {% if chemical.melting_point %}
                                <dt class="col-sm-3">Melting Point</dt>
                                <dd class="col-sm-9">{{ chemical.melting_point }} °C</dd>
                            {% endif %}
                            {% if chemical.boiling_point %}
                                <dt class="col-sm-3">Boiling Point</dt>
                                <dd class="col-sm-9">{{ chemical.boiling_point }} °C</dd>
                            {% endif %}
                            {% if chemical.density %}
                                <dt class="col-sm-3">Density</dt>
                                <dd class="col-sm-9">{{ chemical.density }} g/L</dd>
                            {% endif %}
                        </dl>
                    </div>
                    <div class="collapse show" id="collapseStock-{{ chemical.id }}">
                        {% for stock in chemical.stock_set.all %}
                            <div class="list-group">
                                <div class="list-group-item list-group-item-action flex-column align-items-start">
                                    <div class="d-flex w-100 justify-content-between">
                                        <a class="h5" href="{% url 'stock-update' stock.id %}">{{ stock.name }}</a>
                                        {% if stock.unit %}
                                            <a class="h5 btn btn-outline-info" data-toggle="tooltip"
                                               data-placement="top"
                                               title="Create new Extraction"
                                               href="{% url 'extraction-create' stock.id %}">
                                                {{ stock.quantity }} {{ stock.unit }}
                                            </a>
                                        {% else %}
                                            <h5>{{ stock.quantity }} - </h5>
                                        {% endif %}
                                    </div>
                                    <!-- Just temporary table -->
                                    <!-- Editable Text -->
                                    <!-- End -->
                                    {% if stock.comment %}
                                        <p class="mb-1">{{ stock.comment }}</p>
                                    {% endif %}
                                    {#                            <p class="mb-1">Here should be button to delete and form to extract some.</p>#}
                                    <small class="text-muted">{{ stock.date_created|date:"D d. F Y" }}</small>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </article>
    {% endfor %}

    <!-- Pagination -->
    {% if is_paginated %}
        {% if page_obj.has_previous %}
            <a class="btn btn-outline-info mb-4" href="?page=1">First</a>
            <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.previous_page_number }}">Previous</a>
        {% endif %}

        {% for num in paginator.page_range %}
            {% if page_obj.number == num %}
                <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
            {% elif num > page_obj.number|add:'-3' and  num < page_obj.number|add:'3' %}
                <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
            {% endif %}
        {% endfor %}


        {% if page_obj.has_next %}
            <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.next_page_number }}">Next</a>
            <a class="btn btn-outline-info mb-4" href="?page={{ paginator.num_pages }}">Last</a>
        {% endif %}
    {% endif %}
{% endblock content %}

{% block properties %}
    <div class="content-section">
        <a href="{% url 'chemical-create' %}" class="btn btn-info">Add Chemical</a>
    </div>
{% endblock properties %}